<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>安装 | NodeJS</title>
    <meta name="description" content="Learn Cookbook">
    
    
    <link rel="preload" href="/assets/css/0.styles.34788bb2.css" as="style"><link rel="preload" href="/assets/js/app.12ca0aa8.js" as="script"><link rel="preload" href="/assets/js/2.74bffc86.js" as="script"><link rel="preload" href="/assets/js/6.95fccca8.js" as="script"><link rel="prefetch" href="/assets/js/10.b17cd786.js"><link rel="prefetch" href="/assets/js/100.49143f76.js"><link rel="prefetch" href="/assets/js/101.58f5e966.js"><link rel="prefetch" href="/assets/js/102.0d1b5f3c.js"><link rel="prefetch" href="/assets/js/103.d2dfeb4d.js"><link rel="prefetch" href="/assets/js/104.221dfde0.js"><link rel="prefetch" href="/assets/js/105.89693a0d.js"><link rel="prefetch" href="/assets/js/106.dd9b2874.js"><link rel="prefetch" href="/assets/js/107.b128334b.js"><link rel="prefetch" href="/assets/js/108.d0fceeff.js"><link rel="prefetch" href="/assets/js/109.a36abbdb.js"><link rel="prefetch" href="/assets/js/11.3a5bf6a3.js"><link rel="prefetch" href="/assets/js/110.24de8f58.js"><link rel="prefetch" href="/assets/js/111.ad2322c5.js"><link rel="prefetch" href="/assets/js/112.ebf5a5e6.js"><link rel="prefetch" href="/assets/js/113.945153eb.js"><link rel="prefetch" href="/assets/js/114.89fb0b54.js"><link rel="prefetch" href="/assets/js/115.32747b75.js"><link rel="prefetch" href="/assets/js/116.2ac5709d.js"><link rel="prefetch" href="/assets/js/117.33f44883.js"><link rel="prefetch" href="/assets/js/118.080ca422.js"><link rel="prefetch" href="/assets/js/119.3696781e.js"><link rel="prefetch" href="/assets/js/12.49c205ea.js"><link rel="prefetch" href="/assets/js/120.8629050e.js"><link rel="prefetch" href="/assets/js/121.c541c819.js"><link rel="prefetch" href="/assets/js/122.0beeab62.js"><link rel="prefetch" href="/assets/js/123.f4aacc83.js"><link rel="prefetch" href="/assets/js/124.7b0ddfcc.js"><link rel="prefetch" href="/assets/js/125.b8173440.js"><link rel="prefetch" href="/assets/js/126.9ee9486f.js"><link rel="prefetch" href="/assets/js/127.6c6aee84.js"><link rel="prefetch" href="/assets/js/128.8100734d.js"><link rel="prefetch" href="/assets/js/129.adb74c9f.js"><link rel="prefetch" href="/assets/js/13.b12048d4.js"><link rel="prefetch" href="/assets/js/130.7dbfe596.js"><link rel="prefetch" href="/assets/js/131.a32c075c.js"><link rel="prefetch" href="/assets/js/132.6a0aa273.js"><link rel="prefetch" href="/assets/js/133.52f806e2.js"><link rel="prefetch" href="/assets/js/134.a196478b.js"><link rel="prefetch" href="/assets/js/135.83dc683e.js"><link rel="prefetch" href="/assets/js/136.e31ffd18.js"><link rel="prefetch" href="/assets/js/137.c9dbde0b.js"><link rel="prefetch" href="/assets/js/138.4d1cd5eb.js"><link rel="prefetch" href="/assets/js/139.432cf5af.js"><link rel="prefetch" href="/assets/js/14.daaf0416.js"><link rel="prefetch" href="/assets/js/140.f86409f6.js"><link rel="prefetch" href="/assets/js/141.3abe86ad.js"><link rel="prefetch" href="/assets/js/142.4f6fc92f.js"><link rel="prefetch" href="/assets/js/143.1535cab9.js"><link rel="prefetch" href="/assets/js/144.eefe99f6.js"><link rel="prefetch" href="/assets/js/145.0a2bc4ed.js"><link rel="prefetch" href="/assets/js/146.0e7b17e8.js"><link rel="prefetch" href="/assets/js/147.aecc5e52.js"><link rel="prefetch" href="/assets/js/148.55697156.js"><link rel="prefetch" href="/assets/js/149.78d2096d.js"><link rel="prefetch" href="/assets/js/15.45e9a802.js"><link rel="prefetch" href="/assets/js/150.e6c87191.js"><link rel="prefetch" href="/assets/js/151.a8009d6e.js"><link rel="prefetch" href="/assets/js/152.63d8fdec.js"><link rel="prefetch" href="/assets/js/153.3bfc0798.js"><link rel="prefetch" href="/assets/js/154.65d2ca87.js"><link rel="prefetch" href="/assets/js/155.6eeb8114.js"><link rel="prefetch" href="/assets/js/156.651636fd.js"><link rel="prefetch" href="/assets/js/157.91eccdc2.js"><link rel="prefetch" href="/assets/js/158.dbf5b9d8.js"><link rel="prefetch" href="/assets/js/159.823f0880.js"><link rel="prefetch" href="/assets/js/16.e71df8d4.js"><link rel="prefetch" href="/assets/js/160.cfed749a.js"><link rel="prefetch" href="/assets/js/161.84daf4cb.js"><link rel="prefetch" href="/assets/js/162.ceb37edb.js"><link rel="prefetch" href="/assets/js/163.d225972f.js"><link rel="prefetch" href="/assets/js/164.74f77e4a.js"><link rel="prefetch" href="/assets/js/165.e158fe5d.js"><link rel="prefetch" href="/assets/js/166.c41de610.js"><link rel="prefetch" href="/assets/js/167.7df65d3f.js"><link rel="prefetch" href="/assets/js/168.919437c8.js"><link rel="prefetch" href="/assets/js/169.9bcafe9d.js"><link rel="prefetch" href="/assets/js/17.7dc7c03f.js"><link rel="prefetch" href="/assets/js/170.f33f16fb.js"><link rel="prefetch" href="/assets/js/171.59cd7a83.js"><link rel="prefetch" href="/assets/js/172.e059a6f4.js"><link rel="prefetch" href="/assets/js/173.811a1b3e.js"><link rel="prefetch" href="/assets/js/174.e8d72986.js"><link rel="prefetch" href="/assets/js/175.3ee31f58.js"><link rel="prefetch" href="/assets/js/176.437ff1a6.js"><link rel="prefetch" href="/assets/js/177.0d04f570.js"><link rel="prefetch" href="/assets/js/178.45296cb6.js"><link rel="prefetch" href="/assets/js/179.4176b858.js"><link rel="prefetch" href="/assets/js/18.7d64b721.js"><link rel="prefetch" href="/assets/js/180.a2c20ea9.js"><link rel="prefetch" href="/assets/js/181.77390ab1.js"><link rel="prefetch" href="/assets/js/182.8ebcfdac.js"><link rel="prefetch" href="/assets/js/183.8a6b9bc8.js"><link rel="prefetch" href="/assets/js/184.a8587cd6.js"><link rel="prefetch" href="/assets/js/185.763d219b.js"><link rel="prefetch" href="/assets/js/186.d1c67c82.js"><link rel="prefetch" href="/assets/js/187.d0379152.js"><link rel="prefetch" href="/assets/js/188.3935a5a7.js"><link rel="prefetch" href="/assets/js/189.d40e35ad.js"><link rel="prefetch" href="/assets/js/19.1f322990.js"><link rel="prefetch" href="/assets/js/190.f5168c2b.js"><link rel="prefetch" href="/assets/js/191.00fd22a9.js"><link rel="prefetch" href="/assets/js/192.bb76bc33.js"><link rel="prefetch" href="/assets/js/193.0028d6ac.js"><link rel="prefetch" href="/assets/js/194.504c913a.js"><link rel="prefetch" href="/assets/js/195.6d91833a.js"><link rel="prefetch" href="/assets/js/20.520e4112.js"><link rel="prefetch" href="/assets/js/21.1da5f168.js"><link rel="prefetch" href="/assets/js/22.d42c6e1f.js"><link rel="prefetch" href="/assets/js/23.158333f0.js"><link rel="prefetch" href="/assets/js/24.4933f40a.js"><link rel="prefetch" href="/assets/js/25.057c428c.js"><link rel="prefetch" href="/assets/js/26.de289859.js"><link rel="prefetch" href="/assets/js/27.b14ef5da.js"><link rel="prefetch" href="/assets/js/28.b1329e69.js"><link rel="prefetch" href="/assets/js/29.49d46c7a.js"><link rel="prefetch" href="/assets/js/3.9fae61cb.js"><link rel="prefetch" href="/assets/js/30.83d321ec.js"><link rel="prefetch" href="/assets/js/31.65f56091.js"><link rel="prefetch" href="/assets/js/32.78fcc539.js"><link rel="prefetch" href="/assets/js/33.87e5077b.js"><link rel="prefetch" href="/assets/js/34.a4bf065f.js"><link rel="prefetch" href="/assets/js/35.b81d32e6.js"><link rel="prefetch" href="/assets/js/36.9ef245a6.js"><link rel="prefetch" href="/assets/js/37.4e2664a6.js"><link rel="prefetch" href="/assets/js/38.f8b21767.js"><link rel="prefetch" href="/assets/js/39.294b2e23.js"><link rel="prefetch" href="/assets/js/4.554dccb8.js"><link rel="prefetch" href="/assets/js/40.a35c8bd3.js"><link rel="prefetch" href="/assets/js/41.d60f7eb3.js"><link rel="prefetch" href="/assets/js/42.30f5ce46.js"><link rel="prefetch" href="/assets/js/43.101904fa.js"><link rel="prefetch" href="/assets/js/44.475772ec.js"><link rel="prefetch" href="/assets/js/45.58a6227c.js"><link rel="prefetch" href="/assets/js/46.045cad94.js"><link rel="prefetch" href="/assets/js/47.63628bb5.js"><link rel="prefetch" href="/assets/js/48.4f86f4a6.js"><link rel="prefetch" href="/assets/js/49.92a2af24.js"><link rel="prefetch" href="/assets/js/5.bfcb02d1.js"><link rel="prefetch" href="/assets/js/50.b7fd8454.js"><link rel="prefetch" href="/assets/js/51.9bbf3588.js"><link rel="prefetch" href="/assets/js/52.53f6da60.js"><link rel="prefetch" href="/assets/js/53.b415231c.js"><link rel="prefetch" href="/assets/js/54.53388fc4.js"><link rel="prefetch" href="/assets/js/55.fc24bc21.js"><link rel="prefetch" href="/assets/js/56.9b3c2535.js"><link rel="prefetch" href="/assets/js/57.ba13dd55.js"><link rel="prefetch" href="/assets/js/58.9a4c6a43.js"><link rel="prefetch" href="/assets/js/59.96e435e7.js"><link rel="prefetch" href="/assets/js/60.d17a46b6.js"><link rel="prefetch" href="/assets/js/61.0860ef3f.js"><link rel="prefetch" href="/assets/js/62.713860bc.js"><link rel="prefetch" href="/assets/js/63.38e7edcf.js"><link rel="prefetch" href="/assets/js/64.176f8bbb.js"><link rel="prefetch" href="/assets/js/65.903f4b50.js"><link rel="prefetch" href="/assets/js/66.1c5277a5.js"><link rel="prefetch" href="/assets/js/67.abfce232.js"><link rel="prefetch" href="/assets/js/68.37814697.js"><link rel="prefetch" href="/assets/js/69.c77c3c67.js"><link rel="prefetch" href="/assets/js/7.d035404c.js"><link rel="prefetch" href="/assets/js/70.742159c8.js"><link rel="prefetch" href="/assets/js/71.00f8f464.js"><link rel="prefetch" href="/assets/js/72.c8145491.js"><link rel="prefetch" href="/assets/js/73.edd94acd.js"><link rel="prefetch" href="/assets/js/74.deb52f36.js"><link rel="prefetch" href="/assets/js/75.5969aaa2.js"><link rel="prefetch" href="/assets/js/76.24433b28.js"><link rel="prefetch" href="/assets/js/77.e1a029bc.js"><link rel="prefetch" href="/assets/js/78.ec41973a.js"><link rel="prefetch" href="/assets/js/79.a8436b64.js"><link rel="prefetch" href="/assets/js/8.d1c35f37.js"><link rel="prefetch" href="/assets/js/80.70d752cd.js"><link rel="prefetch" href="/assets/js/81.5392aaa4.js"><link rel="prefetch" href="/assets/js/82.87f6938e.js"><link rel="prefetch" href="/assets/js/83.9efaf755.js"><link rel="prefetch" href="/assets/js/84.d0bba92a.js"><link rel="prefetch" href="/assets/js/85.f8f968c5.js"><link rel="prefetch" href="/assets/js/86.9e5296f6.js"><link rel="prefetch" href="/assets/js/87.8774d4bd.js"><link rel="prefetch" href="/assets/js/88.7513e6b5.js"><link rel="prefetch" href="/assets/js/89.421b5237.js"><link rel="prefetch" href="/assets/js/9.220b3eb6.js"><link rel="prefetch" href="/assets/js/90.47497ac9.js"><link rel="prefetch" href="/assets/js/91.20e7b656.js"><link rel="prefetch" href="/assets/js/92.ab742aa0.js"><link rel="prefetch" href="/assets/js/93.6f6eef2e.js"><link rel="prefetch" href="/assets/js/94.b8ff20d8.js"><link rel="prefetch" href="/assets/js/95.e97d80de.js"><link rel="prefetch" href="/assets/js/96.7f9bfe96.js"><link rel="prefetch" href="/assets/js/97.5bc5b95e.js"><link rel="prefetch" href="/assets/js/98.07280354.js"><link rel="prefetch" href="/assets/js/99.be9ded95.js">
    <link rel="stylesheet" href="/assets/css/0.styles.34788bb2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">NodeJS</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/core/" class="nav-link">Node</a></div><div class="nav-item"><a href="/packageManager/" class="nav-link">Manager</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Nestjs" class="dropdown-title"><span class="title">Nestjs</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/framework/nestjs/office-docs/" class="nav-link">NestJS 官方文档</a></li><li class="dropdown-item"><!----> <a href="/nestjs/source-codes/" class="nav-link">NestJS 源码</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="framework" class="dropdown-title"><span class="title">framework</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/framework/egg/" class="nav-link">egg</a></li><li class="dropdown-item"><!----> <a href="/framework/express/" class="nav-link">express</a></li><li class="dropdown-item"><!----> <a href="/framework/fasitify/" class="nav-link">fasitify</a></li><li class="dropdown-item"><!----> <a href="/framework/hapi/" class="nav-link">hapi</a></li><li class="dropdown-item"><!----> <a href="/framework/koa/" class="nav-link">koa</a></li><li class="dropdown-item"><!----> <a href="/framework/midway/" class="nav-link">midway</a></li></ul></div></div><div class="nav-item"><a href="/graphql/" class="nav-link">graphql</a></div><div class="nav-item"><a href="/TypeORM/" class="nav-link router-link-active">TypeORM</a></div><div class="nav-item"><a href="/branchmark/" class="nav-link">性能</a></div><div class="nav-item"><a href="/vendor/" class="nav-link">第三方包</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/core/" class="nav-link">Node</a></div><div class="nav-item"><a href="/packageManager/" class="nav-link">Manager</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Nestjs" class="dropdown-title"><span class="title">Nestjs</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/framework/nestjs/office-docs/" class="nav-link">NestJS 官方文档</a></li><li class="dropdown-item"><!----> <a href="/nestjs/source-codes/" class="nav-link">NestJS 源码</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="framework" class="dropdown-title"><span class="title">framework</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/framework/egg/" class="nav-link">egg</a></li><li class="dropdown-item"><!----> <a href="/framework/express/" class="nav-link">express</a></li><li class="dropdown-item"><!----> <a href="/framework/fasitify/" class="nav-link">fasitify</a></li><li class="dropdown-item"><!----> <a href="/framework/hapi/" class="nav-link">hapi</a></li><li class="dropdown-item"><!----> <a href="/framework/koa/" class="nav-link">koa</a></li><li class="dropdown-item"><!----> <a href="/framework/midway/" class="nav-link">midway</a></li></ul></div></div><div class="nav-item"><a href="/graphql/" class="nav-link">graphql</a></div><div class="nav-item"><a href="/TypeORM/" class="nav-link router-link-active">TypeORM</a></div><div class="nav-item"><a href="/branchmark/" class="nav-link">性能</a></div><div class="nav-item"><a href="/vendor/" class="nav-link">第三方包</a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h1> <p>npm 包安装：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> typeorm --save
<span class="token function">npm</span> <span class="token function">install</span> reflect-metadata --save
<span class="token function">npm</span> <span class="token function">install</span> @types/node --save
</code></pre></div><h2 id="添加"><a href="#添加" class="header-anchor">#</a> 添加</h2> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token string">&quot;reflect-metadata&quot;</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token string">&quot;reflect-metadata&quot;</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="tsconfig-json-的配置"><a href="#tsconfig-json-的配置" class="header-anchor">#</a> tsconfig.json 的配置</h2> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;emitDecoratorMetadata&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;experimentalDecorators&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="mongodb"><a href="#mongodb" class="header-anchor">#</a> mongodb</h2> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> mongodb --save
</code></pre></div><h2 id="starter"><a href="#starter" class="header-anchor">#</a> starter</h2> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> typeorm -g

<span class="token comment"># 初始化命令</span>
typeorm init --name MyProject --database mysql
</code></pre></div><ul><li>mysql</li> <li>mariadb</li> <li>postgres</li> <li>cockroachdb</li> <li>sqlite</li> <li>mssql</li> <li>oracle</li> <li>mongodb</li> <li>cordova</li> <li>react-native</li> <li>expo</li> <li>nativescript</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>MyProject
├── src              // place of your TypeScript code
│   ├── entity       // place where your entities <span class="token punctuation">(</span>database models<span class="token punctuation">)</span> are stored
│   │   └── User.ts  // sample entity
│   ├── migration    // place where your migrations are stored
│   └── index.ts     // start point of your application
├── .gitignore       // standard gitignore <span class="token function">file</span>
├── ormconfig.json   // ORM and database connection configuration
├── package.json     // node module dependencies
├── README.md        // simple readme <span class="token function">file</span>
└── tsconfig.json    // TypeScript compiler options
</code></pre></div><p>安装过程中， 编辑 ormconfig.json 文件并在其中放置您自己的数据库连接配置选项</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
   <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;host&quot;</span><span class="token operator">:</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">3306</span><span class="token punctuation">,</span>
   <span class="token property">&quot;username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;password&quot;</span><span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;database&quot;</span><span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;synchronize&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
   <span class="token property">&quot;logging&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
   <span class="token property">&quot;entities&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;src/entity/**/*.ts&quot;</span>
   <span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token property">&quot;migrations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;src/migration/**/*.ts&quot;</span>
   <span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token property">&quot;subscribers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;src/subscriber/**/*.ts&quot;</span>
   <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>与 express 结合</p> <div class="language-sh extra-class"><pre class="language-sh"><code>typeorm init --name MyProject --database mysql --express
</code></pre></div><h2 id="创建一个模型"><a href="#创建一个模型" class="header-anchor">#</a> 创建一个模型</h2> <p>从创建表开始使用数据库。您如何告诉TypeORM创建数据库表？答案是-通过模型。应用程序中的模型就是数据库表。</p> <p>例如，您有一个Photo模型：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Photo</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  description<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  filename<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  views<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  isPublished<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre></div><p>您想将照片存储在数据库中。要将内容存储在数据库中，首先需要一个数据库表，然后从模型中创建数据库表。并非所有模型，只有定义为实体的模型。</p> <h2 id="创建一个实体"><a href="#创建一个实体" class="header-anchor">#</a> 创建一个实体</h2> <p>实体是由@Entity装饰器装饰的模型。将为此类模型创建数据库表。您可以使用TypeORM在任何地方使用实体。您可以使用它们加载/插入/更新/删除并执行其他操作。</p> <p>让我们将Photo模型作为一个实体:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Entity<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;typeorm&quot;</span><span class="token punctuation">;</span>

@<span class="token function">Entity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Photo</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    description<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    filename<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    views<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    isPublished<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>现在，将为Photo实体创建一个数据库表，我们将能够在应用程序中的任何地方使用它。我们已经创建了一个数据库表，但是没有列的表可以存在吗？让我们在数据库表中创建几列。</p> <h2 id="添加表格列"><a href="#添加表格列" class="header-anchor">#</a> 添加表格列</h2> <p>要添加数据库列，您只需要使用装饰器将要制作的实体属性@Column装饰为一列即可。</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Entity<span class="token punctuation">,</span> Column<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;typeorm&quot;</span><span class="token punctuation">;</span>

@<span class="token function">Entity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Photo</span> <span class="token punctuation">{</span>

    @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

    @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

    @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    description<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

    @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    filename<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

    @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    views<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

    @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    isPublished<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>现在id，name，description，filename，views和isPublished列将被添加到photo表中。在数据库列类型从您使用的属性类型，例如推断 number将被转换成integer，string成varchar，boolean成bool，等等。但是你可以用任何栏明确指定列类型为类型数据库支持的@Column装饰。</p> <p>我们生成了带有列的数据库表，但是还剩下一件事。每个数据库表必须具有带主键的列。</p> <h2 id="创建一个主列"><a href="#创建一个主列" class="header-anchor">#</a> 创建一个主列</h2> <p>每个实体必须至少具有一个主键列。这是一项要求，您无法避免。要使列成为主键，您需要使用@PrimaryColumn装饰器。</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Entity<span class="token punctuation">,</span> Column<span class="token punctuation">,</span> PrimaryColumn<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;typeorm&quot;</span><span class="token punctuation">;</span>

@<span class="token function">Entity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Photo</span> <span class="token punctuation">{</span>

    @<span class="token function">PrimaryColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

    @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

    @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    description<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

    @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    filename<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

    @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    views<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

    @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    isPublished<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="创建一个自动生成的列"><a href="#创建一个自动生成的列" class="header-anchor">#</a> 创建一个自动生成的列</h2> <p>现在，假设您要自动生成id列（这称为自动增量/序列/序列/生成的身份列）。为此，您需要将@PrimaryColumn装饰器更改为装饰@PrimaryGeneratedColumn器：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Entity<span class="token punctuation">,</span> Column<span class="token punctuation">,</span> PrimaryGeneratedColumn<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;typeorm&quot;</span><span class="token punctuation">;</span>

@<span class="token function">Entity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Photo</span> <span class="token punctuation">{</span>

    @<span class="token function">PrimaryGeneratedColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

    @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

    @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    description<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

    @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    filename<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

    @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    views<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

    @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    isPublished<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="列数据类型"><a href="#列数据类型" class="header-anchor">#</a> 列数据类型</h2> <p>接下来，让我们修复数据类型。默认情况下，字符串映射到类似varchar（255）的类型（取决于数据库类型）。Number映射为类似整数的类型（取决于数据库类型）。我们不希望所有列都限制为varchars或整数。让我们设置正确的数据类型：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Entity<span class="token punctuation">,</span> Column<span class="token punctuation">,</span> PrimaryGeneratedColumn <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'typeorm'</span>

@<span class="token function">Entity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Photo</span> <span class="token punctuation">{</span>
  
  @<span class="token function">PrimaryGeneratedColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  
  @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    length<span class="token operator">:</span> <span class="token number">100</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  
  @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">)</span>
  description<span class="token operator">:</span> <span class="token builtin">string</span>
  
  @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token string">'double'</span><span class="token punctuation">)</span>
  views<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  
  @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  isPublished<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>列类型是特定于数据库的。您可以设置数据库支持的任何列类型。有关支持的列类型的更多信息，请参见此处。</p> <h2 id="创建于数据库的链接"><a href="#创建于数据库的链接" class="header-anchor">#</a> 创建于数据库的链接</h2> <p>现在，当我们创建实体时，让我们创建一个index.ts（或app.ts任何您称其为）文件并在此处建立连接：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token string">'reflect-metadata'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createConnection <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'typeorm'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Photo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./entity/Photo'</span><span class="token punctuation">;</span>

<span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">'mysql'</span><span class="token punctuation">,</span>
  host<span class="token operator">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
  port<span class="token operator">:</span> <span class="token number">3306</span><span class="token punctuation">,</span>
  username<span class="token operator">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
  password<span class="token operator">:</span> <span class="token string">'admin'</span><span class="token punctuation">,</span>
  database<span class="token operator">:</span> <span class="token string">'test'</span><span class="token punctuation">,</span>
  entities<span class="token operator">:</span> <span class="token punctuation">[</span>
    Phtot
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  synchronize<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  logging<span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">connection</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// your logic</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>在此示例中，我们使用MySQL，但您可以使用任何其他受支持的数据库。要使用其他数据库，只需更改type的选项，您正在使用的数据库类型： mysql，mariadb，postgres，cockroachdb，sqlite，mssql，oracle，cordova，nativescript，react-native， expo，或mongodb。另外，请确保使用您自己的主机，端口，用户名，密码和数据库设置。</p> <p>我们将Photo实体添加到了此连接的实体列表中。您在连接中使用的每个实体都必须在此处列出。</p> <p>设置synchronize可确保您每次运行应用程序时，您的实体都将与数据库同步。</p> <h2 id="从目录加载所有实体"><a href="#从目录加载所有实体" class="header-anchor">#</a> 从目录加载所有实体</h2> <p>稍后，当我们创建更多实体时，我们需要将它们添加到配置中的实体中。这不是很方便，因此我们可以设置整个目录，从该目录将连接所有实体并在我们的连接中使用它们：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createConnection <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'typeorm'</span><span class="token punctuation">;</span>

<span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">'mysql'</span><span class="token punctuation">,</span>
  host<span class="token operator">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
  port<span class="token operator">:</span> <span class="token number">3306</span><span class="token punctuation">,</span>
  username<span class="token operator">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
  password<span class="token operator">:</span> <span class="token string">'admin'</span><span class="token punctuation">,</span>
  database<span class="token operator">:</span> <span class="token string">'test'</span><span class="token punctuation">,</span>
  entities<span class="token operator">:</span> <span class="token punctuation">[</span>
    __dirname <span class="token operator">+</span> <span class="token string">'/entity/*.js'</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  synchronize<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">connection</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// your logic</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>但是请谨慎使用此方法。如果正在使用，ts-node则需要指定.ts文件的路径。如果正在使用，outDir则需要.js在outDir目录中指定文件的路径。如果您正在使用，outDir并且在删除或重命名实体时，请确保清除outDir目录并再次重新编译您的项目，因为在删除源.ts文件时，它们的编译.js版本不会从输出目录中删除，而仍然由TypeORM加载，因为它们在outDir目录中。</p> <h2 id="运行应用程序"><a href="#运行应用程序" class="header-anchor">#</a> 运行应用程序</h2> <p>现在，如果您运行index.ts，则将初始化与数据库的连接，并为您的照片创建数据库表。</p> <div class="language-text extra-class"><pre class="language-text"><code>+-------------+--------------+----------------------------+
|                         photo                           |
+-------------+--------------+----------------------------+
| id          | int(11)      | PRIMARY KEY AUTO_INCREMENT |
| name        | varchar(100) |                            |
| description | text         |                            |
| filename    | varchar(255) |                            |
| views       | int(11)      |                            |
| isPublished | boolean      |                            |
+-------------+--------------+----------------------------+
</code></pre></div><h2 id="创建照片并将其插入数据库"><a href="#创建照片并将其插入数据库" class="header-anchor">#</a> 创建照片并将其插入数据库</h2> <p>现在，让我们创建一张新照片以将其保存在数据库中：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createConnection <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'typeorm'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Photo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./entity/Photo'</span>

<span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">connection</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> photo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Photo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    photo<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Me and Bears&quot;</span><span class="token punctuation">;</span>
    photo<span class="token punctuation">.</span>description <span class="token operator">=</span> <span class="token string">&quot;I am near polar bears&quot;</span><span class="token punctuation">;</span>
    photo<span class="token punctuation">.</span>filename <span class="token operator">=</span> <span class="token string">&quot;photo-with-bears.jpg&quot;</span><span class="token punctuation">;</span>
    photo<span class="token punctuation">.</span>views <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    photo<span class="token punctuation">.</span>isPublished <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> connection<span class="token punctuation">.</span>manager
            <span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>photo<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">photo</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Photo has been saved. Photo id is&quot;</span><span class="token punctuation">,</span> photo<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>保存您的实体后，它将获得一个新生成的ID。 save方法返回传递给它的同一对象的实例。它不是对象的新副本，它会修改其“ id”并返回它。</p> <h2 id="使用异步-等待语法"><a href="#使用异步-等待语法" class="header-anchor">#</a> 使用异步/等待语法</h2> <p>让我们利用最新的ES8（ES2017）功能，并使用async / await语法代替：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createconnection <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'typeorm'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Photo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./entity/Photo'</span>

<span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">connection</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> photo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Photo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  photo<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Me and Bears&quot;</span><span class="token punctuation">;</span>
  photo<span class="token punctuation">.</span>description <span class="token operator">=</span> <span class="token string">&quot;I am near polar bears&quot;</span><span class="token punctuation">;</span>
  photo<span class="token punctuation">.</span>filename <span class="token operator">=</span> <span class="token string">&quot;photo-with-bears.jpg&quot;</span><span class="token punctuation">;</span>
  photo<span class="token punctuation">.</span>views <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  photo<span class="token punctuation">.</span>isPublished <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  
  <span class="token keyword">await</span> connection<span class="token punctuation">.</span>manager<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>photo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Photo has been saved&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="使用实体管理器"><a href="#使用实体管理器" class="header-anchor">#</a> 使用实体管理器</h2> <p>我们刚刚创建了一张新照片，并将其保存在数据库中。我们曾经EntityManager保存它。使用实体管理器，您可以操纵应用程序中的任何实体。例如，让我们加载保存的实体：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>createConnection<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;typeorm&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Photo<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./entity/Photo&quot;</span><span class="token punctuation">;</span>

<span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token comment">/*...*/</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">connection</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    <span class="token comment">/*...*/</span>
    <span class="token keyword">let</span> savedPhotos <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span>manager<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>Photo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;All photos from the db: &quot;</span><span class="token punctuation">,</span> savedPhotos<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>savedPhotos 将是一个Photo对象数组，其中包含从数据库加载的数据。</p> <p>在此处了解有关EntityManager的更多信息。</p> <h2 id="使用存储器"><a href="#使用存储器" class="header-anchor">#</a> 使用存储器</h2> <p>现在，让我们重构代码并使用Repository代替EntityManager。每个实体都有其自己的存储库，该存储库处理与其实体的所有操作。当您处理大量实体时，存储库比EntityManagers更方便使用：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createConnection <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'typeorm'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Photo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./entity/Photo'</span>

<span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">connection</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> photo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Photo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    photo<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Me and Bears&quot;</span><span class="token punctuation">;</span>
    photo<span class="token punctuation">.</span>description <span class="token operator">=</span> <span class="token string">&quot;I am near polar bears&quot;</span><span class="token punctuation">;</span>
    photo<span class="token punctuation">.</span>filename <span class="token operator">=</span> <span class="token string">&quot;photo-with-bears.jpg&quot;</span><span class="token punctuation">;</span>
    photo<span class="token punctuation">.</span>views <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    photo<span class="token punctuation">.</span>isPublished <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> photoRepository <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">getRepository</span><span class="token punctuation">(</span>Photo<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">await</span> photoRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>photo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Photo has been saved&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> savedPhotos <span class="token operator">=</span> <span class="token keyword">await</span> photoRepository<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;All photos from the db: &quot;</span><span class="token punctuation">,</span> savedPhotos<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="从数据库加载"><a href="#从数据库加载" class="header-anchor">#</a> 从数据库加载</h2> <p>让我们尝试使用存储库进行更多的加载操作：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createConnection <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'typeorm'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Photo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./entity/Photo'</span>

<span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">connection</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// some your logic</span>
  <span class="token keyword">let</span> allPhotos <span class="token operator">=</span> <span class="token keyword">await</span> photoRepository<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  
  <span class="token keyword">let</span> firstPhoto <span class="token operator">=</span> <span class="token keyword">await</span> photoRepository<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  
  <span class="token keyword">let</span> meAndBearsPhoto <span class="token operator">=</span> <span class="token keyword">await</span> photoRepository<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;Me and Bears&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  
  <span class="token keyword">let</span> meAndBearsPhoto <span class="token operator">=</span> <span class="token keyword">await</span> photoRepository<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;Me and Bears&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  
  <span class="token keyword">let</span> allPublishedPhotos <span class="token operator">=</span> <span class="token keyword">await</span> photoRepository<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> isPublished<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  
  <span class="token keyword">let</span> <span class="token punctuation">[</span>allPhotos<span class="token punctuation">,</span> photosCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> photoRepository<span class="token punctuation">.</span><span class="token function">findAndCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="从数据库中更新"><a href="#从数据库中更新" class="header-anchor">#</a> 从数据库中更新</h2> <p>现在，让我们从数据库中加载一张照片，对其进行更新并保存：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createConnection <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'typeorm'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Photo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./entity/Photo'</span>

<span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">connection</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> photoToUpdate <span class="token operator">=</span> <span class="token keyword">await</span> photoRepository<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  photoToUpdate<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Me, my friends and polar bears&quot;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">await</span> photoRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>photoToUpdate<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>现在，带有的照片id = 1将在数据库中更新。</p> <h2 id="从数据库中删除"><a href="#从数据库中删除" class="header-anchor">#</a> 从数据库中删除</h2> <p>现在，让我们从数据库中删除照片：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>createConnection<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;typeorm&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Photo<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./entity/Photo&quot;</span><span class="token punctuation">;</span>

<span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token comment">/*...*/</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">connection</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    <span class="token comment">/*...*/</span>
    <span class="token keyword">let</span> photoToRemove <span class="token operator">=</span> <span class="token keyword">await</span> photoRepository<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> photoRepository<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>photoToRemove<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>现在，带有的照片id = 1将从数据库中删除。</p> <h2 id="创建一对一关系"><a href="#创建一对一关系" class="header-anchor">#</a> 创建一对一关系</h2> <p>让我们与另一个类创建一对一的关系。让我们在中创建一个新类PhotoMetadata.ts。这个PhotoMetadata类应该包含我们照片的其他元信息：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Entity<span class="token punctuation">,</span> Column<span class="token punctuation">,</span> PrimaryGeneratedColumn<span class="token punctuation">,</span> OneToOne<span class="token punctuation">,</span> JoinColumn<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;typeorm&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Photo<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./Photo&quot;</span><span class="token punctuation">;</span>

@<span class="token function">Entity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">PhotoMetadata</span> <span class="token punctuation">{</span>
  @<span class="token function">PrimaryGeneratedColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  
  @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token string">'int'</span><span class="token punctuation">)</span>
  height<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  
  @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token string">'int'</span><span class="token punctuation">)</span>
  width<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  
  @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  orientation<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  
  @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  compressed<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  
  @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  comment<span class="token operator">:</span> <span class="token builtin">string</span>
  
  @<span class="token function">OneToOne</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">type</span></span> <span class="token operator">=&gt;</span> Photo<span class="token punctuation">)</span>
  @<span class="token function">JoinColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  photo<span class="token operator">:</span> Photo
<span class="token punctuation">}</span>
</code></pre></div><p>在这里，我们使用了一个名为的新装饰器@OneToOne。它允许我们在两个实体之间创建一对一的关系。 <code>type =&gt; Photo</code>是一个函数，该函数返回要与其建立关系的实体的类。由于语言的特殊性，我们被迫使用一个返回类的函数，而不是直接使用该类。我们也可以将其编写为 <code>() =&gt; Photo</code>，但是我们将其<code>type =&gt; Photo</code>用作提高代码可读性的约定。类型变量本身不包含任何内容。</p> <p>我们还添加了一个<code>@JoinColumn</code>装饰器，它指示关系的这一侧将拥有该关系。关系可以是单向或双向的。关系只有一方可以拥有。<code>@JoinColumn</code>关系的所有者端需要使用装饰器。</p> <p>如果运行该应用程序，则会看到一个新生成的表，该表将包含一列，其中包含用于照片关系的外键：</p> <div class="language-txt extra-class"><pre class="language-text"><code>+-------------+--------------+----------------------------+
|                     photo_metadata                      |
+-------------+--------------+----------------------------+
| id          | int(11)      | PRIMARY KEY AUTO_INCREMENT |
| height      | int(11)      |                            |
| width       | int(11)      |                            |
| comment     | varchar(255) |                            |
| compressed  | boolean      |                            |
| orientation | varchar(255) |                            |
| photoId     | int(11)      | FOREIGN KEY                |
+-------------+--------------+----------------------------+
</code></pre></div><h2 id="保存一对一关系"><a href="#保存一对一关系" class="header-anchor">#</a> 保存一对一关系</h2> <p>现在，让我们保存一张照片及其元数据，并将它们彼此附加。</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createConncection <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'typeorm'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Photo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./entity/Photo'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PhotoMetadata <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./entity/PhotoMetadata'</span>

<span class="token function">createConncection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">connection</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> photo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Photo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  photo<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Me and Bears&quot;</span><span class="token punctuation">;</span>
  photo<span class="token punctuation">.</span>description <span class="token operator">=</span> <span class="token string">&quot;I am near polar bears&quot;</span><span class="token punctuation">;</span>
  photo<span class="token punctuation">.</span>filename <span class="token operator">=</span> <span class="token string">&quot;photo-with-bears.jpg&quot;</span><span class="token punctuation">;</span>
  photo<span class="token punctuation">.</span>isPublished <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> metadata <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PhotoMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  metadata<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">640</span><span class="token punctuation">;</span>
  metadata<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">480</span><span class="token punctuation">;</span>
  metadata<span class="token punctuation">.</span>compressed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  metadata<span class="token punctuation">.</span>comment <span class="token operator">=</span> <span class="token string">&quot;cybershoot&quot;</span><span class="token punctuation">;</span>
  metadata<span class="token punctuation">.</span>orientation <span class="token operator">=</span> <span class="token string">&quot;portait&quot;</span><span class="token punctuation">;</span>
  metadata<span class="token punctuation">.</span>photo <span class="token operator">=</span> photo<span class="token punctuation">;</span> <span class="token comment">// this way we connect them</span>
  
  <span class="token keyword">let</span> photoRepository <span class="token operator">=</span> connect<span class="token punctuation">.</span><span class="token function">getRepository</span><span class="token punctuation">(</span>Photo<span class="token punctuation">)</span>
  <span class="token keyword">let</span> metadataRepository <span class="token operator">=</span> connect<span class="token punctuation">.</span><span class="token function">getRepository</span><span class="token punctuation">(</span>PhotoMetadata<span class="token punctuation">)</span>
  
  <span class="token keyword">await</span> photoRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>photo<span class="token punctuation">)</span>
  <span class="token keyword">await</span> metadataRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>metadata<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="关系的反面"><a href="#关系的反面" class="header-anchor">#</a> 关系的反面</h2> <p>关系可以是单向或双向的。当前，我们在PhotoMetadata和Photo之间的关系是单向的。关系的所有者是PhotoMetadata，而Photo对PhotoMetadata一无所知。这使得从Photo端访问PhotoMetadata变得很复杂。若要解决此问题，我们应添加一个反关系，并使PhotoMetadata和Photo之间是双向的。让我们修改我们的实体：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Entity<span class="token punctuation">,</span> Column<span class="token punctuation">,</span> PrimaryGeneratedColumn<span class="token punctuation">,</span> OneToOne<span class="token punctuation">,</span> JoinColumn<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;typeorm&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Photo<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./Photo&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">PhotoMetadata</span> <span class="token punctuation">{</span>
  
  @<span class="token function">OneToOne</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">type</span></span> <span class="token operator">=&gt;</span> Photo<span class="token punctuation">,</span> <span class="token parameter">photo</span> <span class="token operator">=&gt;</span> photo<span class="token punctuation">.</span>metadata<span class="token punctuation">)</span>
  @<span class="token function">JoinColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  photo<span class="token operator">:</span> Photo
<span class="token punctuation">}</span>
</code></pre></div><div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Entity<span class="token punctuation">,</span> Column<span class="token punctuation">,</span> PrimaryGeneratedColumn<span class="token punctuation">,</span> OneToOne<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;typeorm&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>PhotoMetadata<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./PhotoMetadata&quot;</span><span class="token punctuation">;</span>

@<span class="token function">Entity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Photo</span> <span class="token punctuation">{</span>

    <span class="token comment">/* ... other columns */</span>

    @<span class="token function">OneToOne</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">type</span></span> <span class="token operator">=&gt;</span> PhotoMetadata<span class="token punctuation">,</span> <span class="token parameter">photoMetadata</span> <span class="token operator">=&gt;</span> photoMetadata<span class="token punctuation">.</span>photo<span class="token punctuation">)</span>
    metadata<span class="token operator">:</span> PhotoMetadata<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>photo =&gt; photo.metadata是一个函数，它返回关系的反面的名称。在这里，我们显示Photo类的metas属性是我们在Photo类中存储PhotoMetadata的地方。除了传递返回照片属性的函数外，您还可以直接将字符串传递给@OneToOne装饰器，例如&quot;metadata&quot;。但是我们使用了这种函数类型化的方法来简化我们的重构。</p> <p>注意，我们应该@JoinColumn只在关系的一侧使用装饰器。无论您放置此装饰器的哪一侧，都是关系的所有者。关系的拥有方在数据库中包含带有外键的列。</p> <h2 id="加载对象及其关系"><a href="#加载对象及其关系" class="header-anchor">#</a> 加载对象及其关系</h2> <p>现在，让我们在一个查询中加载照片及其照片元数据。有两种方法可以使用-使用find<em>方法或使用QueryBuilder功能。让我们find</em>先使用方法。 find*方法允许您使用<code>FindOneOptions/FindManyOptions</code>接口指定对象。</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createConnection <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'typeorm'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Photo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./entity/Photo'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PhotoMetadata <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./entity/PhotoMetadata'</span>

<span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token comment">/*...*/</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">connection</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    <span class="token comment">/*...*/</span>
    <span class="token keyword">let</span> photoRepository <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">getRepository</span><span class="token punctuation">(</span>Photo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> photos <span class="token operator">=</span> <span class="token keyword">await</span> photoRepository<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> relations<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;metadata&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在这里，照片将包含来自数据库的一系列照片，每张照片将包含其照片元数据。在本文档中了解有关“查找选项”的更多信息。</p> <p>使用查找选项既好又简单，但是如果需要更复杂的查询，则应QueryBuilder改用。 QueryBuilder允许更优雅地使用更复杂的查询：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>createConnection<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;typeorm&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Photo<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./entity/Photo&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>PhotoMetadata<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./entity/PhotoMetadata&quot;</span><span class="token punctuation">;</span>

<span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token comment">/*...*/</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">connection</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    <span class="token comment">/*...*/</span>
    <span class="token keyword">let</span> photos <span class="token operator">=</span> <span class="token keyword">await</span> connection
            <span class="token punctuation">.</span><span class="token function">getRepository</span><span class="token punctuation">(</span>Photo<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">createQueryBuilder</span><span class="token punctuation">(</span><span class="token string">&quot;photo&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">innerJoinAndSelect</span><span class="token punctuation">(</span><span class="token string">&quot;photo.metadata&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;metadata&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">getMany</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>QueryBuilder允许创建和执行几乎任何复杂的SQL查询。当您使用时QueryBuilder，请以为您正在创建SQL查询。在此示例中，“照片”和“元数据”是应用于所选照片的​​别名。您可以使用别名来访问所选数据的列和属性。</p> <h2 id="使用级联自动保存相关对象"><a href="#使用级联自动保存相关对象" class="header-anchor">#</a> 使用级联自动保存相关对象</h2> <p>每次保存另一个对象时都希望保存相关对象的情况下，我们可以在关系中设置级联选项。让我们@OneToOne稍微更改一下照片的装饰器：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Photo</span> <span class="token punctuation">{</span>
    <span class="token comment">/// ... other columns</span>

    @<span class="token function">OneToOne</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">type</span></span> <span class="token operator">=&gt;</span> PhotoMetadata<span class="token punctuation">,</span> <span class="token parameter">metadata</span> <span class="token operator">=&gt;</span> metadata<span class="token punctuation">.</span>photo<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        cascade<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    metadata<span class="token operator">:</span> PhotoMetadata<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用cascade允许我们现在不再单独保存照片和单独保存元数据对象。现在我们只需保存一个照片对象，由于级联选项，元数据对象将被自动保存。</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token function">createConnection</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">connection</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    <span class="token comment">// create photo object</span>
    <span class="token keyword">let</span> photo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Photo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    photo<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Me and Bears&quot;</span><span class="token punctuation">;</span>
    photo<span class="token punctuation">.</span>description <span class="token operator">=</span> <span class="token string">&quot;I am near polar bears&quot;</span><span class="token punctuation">;</span>
    photo<span class="token punctuation">.</span>filename <span class="token operator">=</span> <span class="token string">&quot;photo-with-bears.jpg&quot;</span><span class="token punctuation">;</span>
    photo<span class="token punctuation">.</span>isPublished <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token comment">// create photo metadata object</span>
    <span class="token keyword">let</span> metadata <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PhotoMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    metadata<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">640</span><span class="token punctuation">;</span>
    metadata<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">480</span><span class="token punctuation">;</span>
    metadata<span class="token punctuation">.</span>compressed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    metadata<span class="token punctuation">.</span>comment <span class="token operator">=</span> <span class="token string">&quot;cybershoot&quot;</span><span class="token punctuation">;</span>
    metadata<span class="token punctuation">.</span>orientation <span class="token operator">=</span> <span class="token string">&quot;portait&quot;</span><span class="token punctuation">;</span>

    photo<span class="token punctuation">.</span>metadata <span class="token operator">=</span> metadata<span class="token punctuation">;</span> <span class="token comment">// this way we connect them</span>

    <span class="token comment">// get repository</span>
    <span class="token keyword">let</span> photoRepository <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">getRepository</span><span class="token punctuation">(</span>Photo<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// saving a photo also save the metadata</span>
    <span class="token keyword">await</span> photoRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>photo<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Photo is saved, photo metadata is saved too.&quot;</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>注意，我们现在设置照片的metadata属性，而不是photo像以前那样设置元数据的属性。cascade仅当您从照片侧面将照片连接到其元数据时，此功能才有效。如果设置元数据的一面，则元数据将不会自动保存。</p> <h2 id="创建一对一-一对多关系"><a href="#创建一对一-一对多关系" class="header-anchor">#</a> 创建一对一/一对多关系</h2> <p>让我们创建一个多对一/一对多关系。假设一张照片有一个作者，每个作者可以有很多照片。首先，让我们创建一个Author类：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Entity<span class="token punctuation">,</span> Column<span class="token punctuation">,</span> PrimaryGeneratedColumn<span class="token punctuation">,</span> OneToMany<span class="token punctuation">,</span> JoinColumn<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;typeorm&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Photo<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./Photo&quot;</span><span class="token punctuation">;</span>

@<span class="token function">Entity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Author</span> <span class="token punctuation">{</span>

    @<span class="token function">PrimaryGeneratedColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

    @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

    @<span class="token function">OneToMany</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">type</span></span> <span class="token operator">=&gt;</span> Photo<span class="token punctuation">,</span> <span class="token parameter">photo</span> <span class="token operator">=&gt;</span> photo<span class="token punctuation">.</span>author<span class="token punctuation">)</span> <span class="token comment">// note: we will create author property in the Photo class below</span>
    photos<span class="token operator">:</span> Photo<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Author包含关系的反面。 OneToMany总是关系的反面，没有关系ManyToOne的另一面就不可能存在。</p> <p>现在，将关系的所有者添加到Photo实体中：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Entity<span class="token punctuation">,</span> Column<span class="token punctuation">,</span> PrimaryGeneratedColumn<span class="token punctuation">,</span> ManyToOne<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;typeorm&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>PhotoMetadata<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./PhotoMetadata&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Author<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./Author&quot;</span><span class="token punctuation">;</span>

@<span class="token function">Entity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Photo</span> <span class="token punctuation">{</span>

    <span class="token comment">/* ... other columns */</span>

    @<span class="token function">ManyToOne</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">type</span></span> <span class="token operator">=&gt;</span> Author<span class="token punctuation">,</span> <span class="token parameter">author</span> <span class="token operator">=&gt;</span> author<span class="token punctuation">.</span>photos<span class="token punctuation">)</span>
    author<span class="token operator">:</span> Author<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在多对一/一对多关系中，所有者方始终是多对一。这意味着使用的类@ManyToOne将存储相关对象的ID。</p> <p>运行应用程序后，ORM将创建author表：</p> <div class="language-txt extra-class"><pre class="language-text"><code>+-------------+--------------+----------------------------+
|                          author                         |
+-------------+--------------+----------------------------+
| id          | int(11)      | PRIMARY KEY AUTO_INCREMENT |
| name        | varchar(255) |                            |
+-------------+--------------+----------------------------+
</code></pre></div><p>它还将修改photo表，添加新author列并为其创建外键：</p> <div class="language-txt extra-class"><pre class="language-text"><code>+-------------+--------------+----------------------------+
|                         photo                           |
+-------------+--------------+----------------------------+
| id          | int(11)      | PRIMARY KEY AUTO_INCREMENT |
| name        | varchar(255) |                            |
| description | varchar(255) |                            |
| filename    | varchar(255) |                            |
| isPublished | boolean      |                            |
| authorId    | int(11)      | FOREIGN KEY                |
+-------------+--------------+----------------------------+
</code></pre></div><h2 id="建立多对多关系"><a href="#建立多对多关系" class="header-anchor">#</a> 建立多对多关系</h2> <p>让我们创建一个多对一/多对多关系。假设一张照片可以在许多相册中，并且每个相册可以包含许多照片。让我们创建一个Album类：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Entity<span class="token punctuation">,</span> PrimaryGeneratedColumn<span class="token punctuation">,</span> Column<span class="token punctuation">,</span> ManyToMany<span class="token punctuation">,</span> JoinTable<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;typeorm&quot;</span><span class="token punctuation">;</span>

@<span class="token function">Entity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Album</span> <span class="token punctuation">{</span>

    @<span class="token function">PrimaryGeneratedColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

    @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

    @<span class="token function">ManyToMany</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">type</span></span> <span class="token operator">=&gt;</span> Photo<span class="token punctuation">,</span> <span class="token parameter">photo</span> <span class="token operator">=&gt;</span> photo<span class="token punctuation">.</span>albums<span class="token punctuation">)</span>
    @<span class="token function">JoinTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    photos<span class="token operator">:</span> Photo<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>@JoinTable 需要指定这是关系的所有者。</p> <p>现在让我们将关系的反面添加到Photo类中：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Photo</span> <span class="token punctuation">{</span>
    <span class="token comment">/// ... other columns</span>

    @<span class="token function">ManyToMany</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">type</span></span> <span class="token operator">=&gt;</span> Album<span class="token punctuation">,</span> <span class="token parameter">album</span> <span class="token operator">=&gt;</span> album<span class="token punctuation">.</span>photos<span class="token punctuation">)</span>
    albums<span class="token operator">:</span> Album<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>运行应用程序后，ORM将创建一个album_photos_photo_albums 联结表：</p> <div class="language-txt extra-class"><pre class="language-text"><code>+-------------+--------------+----------------------------+
|                album_photos_photo_albums                |
+-------------+--------------+----------------------------+
| album_id    | int(11)      | PRIMARY KEY FOREIGN KEY    |
| photo_id    | int(11)      | PRIMARY KEY FOREIGN KEY    |
+-------------+--------------+----------------------------+
</code></pre></div><p>不要忘记Album在ORM中通过连接注册该类：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> options<span class="token operator">:</span> ConnectionOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// ... other options</span>
    entities<span class="token operator">:</span> <span class="token punctuation">[</span>Photo<span class="token punctuation">,</span> PhotoMetadata<span class="token punctuation">,</span> Author<span class="token punctuation">,</span> Album<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>现在，让我们将相册和照片插入数据库：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">let</span> connection <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// create a few albums</span>
<span class="token keyword">let</span> album1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Album</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
album1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Bears&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> connection<span class="token punctuation">.</span>manager<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>album1<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> album2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Album</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
album2<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Me&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> connection<span class="token punctuation">.</span>manager<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>album2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// create a few photos</span>
<span class="token keyword">let</span> photo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Photo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
photo<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Me and Bears&quot;</span><span class="token punctuation">;</span>
photo<span class="token punctuation">.</span>description <span class="token operator">=</span> <span class="token string">&quot;I am near polar bears&quot;</span><span class="token punctuation">;</span>
photo<span class="token punctuation">.</span>filename <span class="token operator">=</span> <span class="token string">&quot;photo-with-bears.jpg&quot;</span><span class="token punctuation">;</span>
photo<span class="token punctuation">.</span>albums <span class="token operator">=</span> <span class="token punctuation">[</span>album1<span class="token punctuation">,</span> album2<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> connection<span class="token punctuation">.</span>manager<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>photo<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// now our photo is saved and albums are attached to it</span>
<span class="token comment">// now lets load them:</span>
<span class="token keyword">const</span> loadedPhoto <span class="token operator">=</span> <span class="token keyword">await</span> connection
    <span class="token punctuation">.</span><span class="token function">getRepository</span><span class="token punctuation">(</span>Photo<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> relations<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;albums&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>loadedPhoto 将等于：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">&quot;Me and Bears&quot;</span><span class="token punctuation">,</span>
    description<span class="token operator">:</span> <span class="token string">&quot;I am near polar bears&quot;</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;photo-with-bears.jpg&quot;</span><span class="token punctuation">,</span>
    albums<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> <span class="token string">&quot;Bears&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> <span class="token string">&quot;Me&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="使用-querybuilder"><a href="#使用-querybuilder" class="header-anchor">#</a> 使用 QueryBuilder</h2> <p>您可以使用QueryBuilder来构建几乎任何复杂的SQL查询。例如，您可以这样做：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">let</span> photos <span class="token operator">=</span> <span class="token keyword">await</span> connection
    <span class="token punctuation">.</span><span class="token function">getRepository</span><span class="token punctuation">(</span>Photo<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">createQueryBuilder</span><span class="token punctuation">(</span><span class="token string">&quot;photo&quot;</span><span class="token punctuation">)</span> <span class="token comment">// first argument is an alias. Alias is what you are selecting - photos. You must specify it.</span>
    <span class="token punctuation">.</span><span class="token function">innerJoinAndSelect</span><span class="token punctuation">(</span><span class="token string">&quot;photo.metadata&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;metadata&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">leftJoinAndSelect</span><span class="token punctuation">(</span><span class="token string">&quot;photo.albums&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;album&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;photo.isPublished = true&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">andWhere</span><span class="token punctuation">(</span><span class="token string">&quot;(photo.name = :photoName OR photo.name = :bearName)&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string">&quot;photo.id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;DESC&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setParameters</span><span class="token punctuation">(</span><span class="token punctuation">{</span> photoName<span class="token operator">:</span> <span class="token string">&quot;My&quot;</span><span class="token punctuation">,</span> bearName<span class="token operator">:</span> <span class="token string">&quot;Mishka&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">getMany</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>该查询选择所有带有“我的”或“ Mishka”名称的已发布照片。它将从位置5（分页偏移）选择结果，并且将仅选择10个结果（分页限制）。选择结果将按ID降序排列。该照片的相册将左连接，其元数据将内部连接。</p> <p>您将在应用程序中大量使用查询生成器。在此处了解有关QueryBuilder的更多信息。</p> <h2 id="示例"><a href="#示例" class="header-anchor">#</a> 示例</h2> <ul><li><a href="https://github.com/typeorm/typescript-example" target="_blank" rel="noopener noreferrer">示例如何将TypeORM与TypeScript结合使用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/typeorm/javascript-example" target="_blank" rel="noopener noreferrer">示例如何将TypeORM与JavaScript结合使用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/typeorm/babel-example" target="_blank" rel="noopener noreferrer">示例如何将TypeORM与JavaScript和Babel结合使用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/typeorm/browser-example" target="_blank" rel="noopener noreferrer">示例如何在浏览器中将TypeORM与TypeScript和SystemJS一起使用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/typeorm/typescript-express-example" target="_blank" rel="noopener noreferrer">示例如何使用Express和TypeORM<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/typeorm/typescript-koa-example" target="_blank" rel="noopener noreferrer">示例如何使用Koa和TypeORM<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/typeorm/cordova-example" target="_blank" rel="noopener noreferrer">示例如何在MongoDB中使用TypeORM<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/typeorm/cordova-example" target="_blank" rel="noopener noreferrer">示例如何在Cordova / PhoneGap应用程序中使用TypeORM<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/typeorm/ionic-example" target="_blank" rel="noopener noreferrer">示例如何在Ionic应用程序中使用TypeORM<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/typeorm/react-native-example" target="_blank" rel="noopener noreferrer">示例如何将TypeORM与React Native一起使用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/typeorm/nativescript-vue-typeorm-sample" target="_blank" rel="noopener noreferrer">示例如何将TypeORM与Nativescript-Vue结合使用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/betov18x/nativescript-angular-typeorm-example" target="_blank" rel="noopener noreferrer">示例如何将TypeORM与Nativescript-Angular结合使用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/typeorm/electron-javascript-example" target="_blank" rel="noopener noreferrer">示例如何使用JavaScript将TypeORM与Electron结合使用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/typeorm/electron-typescript-example" target="_blank" rel="noopener noreferrer">示例如何使用TypeScript将TypeORM与Electron结合使用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="扩展"><a href="#扩展" class="header-anchor">#</a> 扩展</h2> <p>有几个扩展可以简化TypeORM的使用以及与其他模块的集成：</p> <ul><li><a href="http://vesper-framework.com/" target="_blank" rel="noopener noreferrer">TypeORM + GraphQL框架<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>TypeORM与<a href="https://github.com/typeorm/typeorm-typedi-extensions" target="_blank" rel="noopener noreferrer">TypeDI<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 集成</li> <li>TypeORM与<a href="https://github.com/pleerock/routing-controllers" target="_blank" rel="noopener noreferrer">路由控制器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>集成</li> <li>从现有数据库生成模型-<a href="https://github.com/Kononnable/typeorm-model-generator" target="_blank" rel="noopener noreferrer">typeorm-model-generator<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>夹具装载机-<a href="https://github.com/RobinCK/typeorm-fixtures" target="_blank" rel="noopener noreferrer">Typeorm-fixtures-cli<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.12ca0aa8.js" defer></script><script src="/assets/js/2.74bffc86.js" defer></script><script src="/assets/js/6.95fccca8.js" defer></script>
  </body>
</html>
