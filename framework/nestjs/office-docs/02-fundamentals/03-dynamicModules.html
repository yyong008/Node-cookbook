<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>动态模块 | NodeJS</title>
    <meta name="description" content="Learn Cookbook">
    
    
    <link rel="preload" href="/assets/css/0.styles.34788bb2.css" as="style"><link rel="preload" href="/assets/js/app.12ca0aa8.js" as="script"><link rel="preload" href="/assets/js/2.74bffc86.js" as="script"><link rel="preload" href="/assets/js/46.045cad94.js" as="script"><link rel="prefetch" href="/assets/js/10.b17cd786.js"><link rel="prefetch" href="/assets/js/100.49143f76.js"><link rel="prefetch" href="/assets/js/101.58f5e966.js"><link rel="prefetch" href="/assets/js/102.0d1b5f3c.js"><link rel="prefetch" href="/assets/js/103.d2dfeb4d.js"><link rel="prefetch" href="/assets/js/104.221dfde0.js"><link rel="prefetch" href="/assets/js/105.89693a0d.js"><link rel="prefetch" href="/assets/js/106.dd9b2874.js"><link rel="prefetch" href="/assets/js/107.b128334b.js"><link rel="prefetch" href="/assets/js/108.d0fceeff.js"><link rel="prefetch" href="/assets/js/109.a36abbdb.js"><link rel="prefetch" href="/assets/js/11.3a5bf6a3.js"><link rel="prefetch" href="/assets/js/110.24de8f58.js"><link rel="prefetch" href="/assets/js/111.ad2322c5.js"><link rel="prefetch" href="/assets/js/112.ebf5a5e6.js"><link rel="prefetch" href="/assets/js/113.945153eb.js"><link rel="prefetch" href="/assets/js/114.89fb0b54.js"><link rel="prefetch" href="/assets/js/115.32747b75.js"><link rel="prefetch" href="/assets/js/116.2ac5709d.js"><link rel="prefetch" href="/assets/js/117.33f44883.js"><link rel="prefetch" href="/assets/js/118.080ca422.js"><link rel="prefetch" href="/assets/js/119.3696781e.js"><link rel="prefetch" href="/assets/js/12.49c205ea.js"><link rel="prefetch" href="/assets/js/120.8629050e.js"><link rel="prefetch" href="/assets/js/121.c541c819.js"><link rel="prefetch" href="/assets/js/122.0beeab62.js"><link rel="prefetch" href="/assets/js/123.f4aacc83.js"><link rel="prefetch" href="/assets/js/124.7b0ddfcc.js"><link rel="prefetch" href="/assets/js/125.b8173440.js"><link rel="prefetch" href="/assets/js/126.9ee9486f.js"><link rel="prefetch" href="/assets/js/127.6c6aee84.js"><link rel="prefetch" href="/assets/js/128.8100734d.js"><link rel="prefetch" href="/assets/js/129.adb74c9f.js"><link rel="prefetch" href="/assets/js/13.b12048d4.js"><link rel="prefetch" href="/assets/js/130.7dbfe596.js"><link rel="prefetch" href="/assets/js/131.a32c075c.js"><link rel="prefetch" href="/assets/js/132.6a0aa273.js"><link rel="prefetch" href="/assets/js/133.52f806e2.js"><link rel="prefetch" href="/assets/js/134.a196478b.js"><link rel="prefetch" href="/assets/js/135.83dc683e.js"><link rel="prefetch" href="/assets/js/136.e31ffd18.js"><link rel="prefetch" href="/assets/js/137.c9dbde0b.js"><link rel="prefetch" href="/assets/js/138.4d1cd5eb.js"><link rel="prefetch" href="/assets/js/139.432cf5af.js"><link rel="prefetch" href="/assets/js/14.daaf0416.js"><link rel="prefetch" href="/assets/js/140.f86409f6.js"><link rel="prefetch" href="/assets/js/141.3abe86ad.js"><link rel="prefetch" href="/assets/js/142.4f6fc92f.js"><link rel="prefetch" href="/assets/js/143.1535cab9.js"><link rel="prefetch" href="/assets/js/144.eefe99f6.js"><link rel="prefetch" href="/assets/js/145.0a2bc4ed.js"><link rel="prefetch" href="/assets/js/146.0e7b17e8.js"><link rel="prefetch" href="/assets/js/147.aecc5e52.js"><link rel="prefetch" href="/assets/js/148.55697156.js"><link rel="prefetch" href="/assets/js/149.78d2096d.js"><link rel="prefetch" href="/assets/js/15.45e9a802.js"><link rel="prefetch" href="/assets/js/150.e6c87191.js"><link rel="prefetch" href="/assets/js/151.a8009d6e.js"><link rel="prefetch" href="/assets/js/152.63d8fdec.js"><link rel="prefetch" href="/assets/js/153.3bfc0798.js"><link rel="prefetch" href="/assets/js/154.65d2ca87.js"><link rel="prefetch" href="/assets/js/155.6eeb8114.js"><link rel="prefetch" href="/assets/js/156.651636fd.js"><link rel="prefetch" href="/assets/js/157.91eccdc2.js"><link rel="prefetch" href="/assets/js/158.dbf5b9d8.js"><link rel="prefetch" href="/assets/js/159.823f0880.js"><link rel="prefetch" href="/assets/js/16.e71df8d4.js"><link rel="prefetch" href="/assets/js/160.cfed749a.js"><link rel="prefetch" href="/assets/js/161.84daf4cb.js"><link rel="prefetch" href="/assets/js/162.ceb37edb.js"><link rel="prefetch" href="/assets/js/163.d225972f.js"><link rel="prefetch" href="/assets/js/164.74f77e4a.js"><link rel="prefetch" href="/assets/js/165.e158fe5d.js"><link rel="prefetch" href="/assets/js/166.c41de610.js"><link rel="prefetch" href="/assets/js/167.7df65d3f.js"><link rel="prefetch" href="/assets/js/168.919437c8.js"><link rel="prefetch" href="/assets/js/169.9bcafe9d.js"><link rel="prefetch" href="/assets/js/17.7dc7c03f.js"><link rel="prefetch" href="/assets/js/170.f33f16fb.js"><link rel="prefetch" href="/assets/js/171.59cd7a83.js"><link rel="prefetch" href="/assets/js/172.e059a6f4.js"><link rel="prefetch" href="/assets/js/173.811a1b3e.js"><link rel="prefetch" href="/assets/js/174.e8d72986.js"><link rel="prefetch" href="/assets/js/175.3ee31f58.js"><link rel="prefetch" href="/assets/js/176.437ff1a6.js"><link rel="prefetch" href="/assets/js/177.0d04f570.js"><link rel="prefetch" href="/assets/js/178.45296cb6.js"><link rel="prefetch" href="/assets/js/179.4176b858.js"><link rel="prefetch" href="/assets/js/18.7d64b721.js"><link rel="prefetch" href="/assets/js/180.a2c20ea9.js"><link rel="prefetch" href="/assets/js/181.77390ab1.js"><link rel="prefetch" href="/assets/js/182.8ebcfdac.js"><link rel="prefetch" href="/assets/js/183.8a6b9bc8.js"><link rel="prefetch" href="/assets/js/184.a8587cd6.js"><link rel="prefetch" href="/assets/js/185.763d219b.js"><link rel="prefetch" href="/assets/js/186.d1c67c82.js"><link rel="prefetch" href="/assets/js/187.d0379152.js"><link rel="prefetch" href="/assets/js/188.3935a5a7.js"><link rel="prefetch" href="/assets/js/189.d40e35ad.js"><link rel="prefetch" href="/assets/js/19.1f322990.js"><link rel="prefetch" href="/assets/js/190.f5168c2b.js"><link rel="prefetch" href="/assets/js/191.00fd22a9.js"><link rel="prefetch" href="/assets/js/192.bb76bc33.js"><link rel="prefetch" href="/assets/js/193.0028d6ac.js"><link rel="prefetch" href="/assets/js/194.504c913a.js"><link rel="prefetch" href="/assets/js/195.6d91833a.js"><link rel="prefetch" href="/assets/js/20.520e4112.js"><link rel="prefetch" href="/assets/js/21.1da5f168.js"><link rel="prefetch" href="/assets/js/22.d42c6e1f.js"><link rel="prefetch" href="/assets/js/23.158333f0.js"><link rel="prefetch" href="/assets/js/24.4933f40a.js"><link rel="prefetch" href="/assets/js/25.057c428c.js"><link rel="prefetch" href="/assets/js/26.de289859.js"><link rel="prefetch" href="/assets/js/27.b14ef5da.js"><link rel="prefetch" href="/assets/js/28.b1329e69.js"><link rel="prefetch" href="/assets/js/29.49d46c7a.js"><link rel="prefetch" href="/assets/js/3.9fae61cb.js"><link rel="prefetch" href="/assets/js/30.83d321ec.js"><link rel="prefetch" href="/assets/js/31.65f56091.js"><link rel="prefetch" href="/assets/js/32.78fcc539.js"><link rel="prefetch" href="/assets/js/33.87e5077b.js"><link rel="prefetch" href="/assets/js/34.a4bf065f.js"><link rel="prefetch" href="/assets/js/35.b81d32e6.js"><link rel="prefetch" href="/assets/js/36.9ef245a6.js"><link rel="prefetch" href="/assets/js/37.4e2664a6.js"><link rel="prefetch" href="/assets/js/38.f8b21767.js"><link rel="prefetch" href="/assets/js/39.294b2e23.js"><link rel="prefetch" href="/assets/js/4.554dccb8.js"><link rel="prefetch" href="/assets/js/40.a35c8bd3.js"><link rel="prefetch" href="/assets/js/41.d60f7eb3.js"><link rel="prefetch" href="/assets/js/42.30f5ce46.js"><link rel="prefetch" href="/assets/js/43.101904fa.js"><link rel="prefetch" href="/assets/js/44.475772ec.js"><link rel="prefetch" href="/assets/js/45.58a6227c.js"><link rel="prefetch" href="/assets/js/47.63628bb5.js"><link rel="prefetch" href="/assets/js/48.4f86f4a6.js"><link rel="prefetch" href="/assets/js/49.92a2af24.js"><link rel="prefetch" href="/assets/js/5.bfcb02d1.js"><link rel="prefetch" href="/assets/js/50.b7fd8454.js"><link rel="prefetch" href="/assets/js/51.9bbf3588.js"><link rel="prefetch" href="/assets/js/52.53f6da60.js"><link rel="prefetch" href="/assets/js/53.b415231c.js"><link rel="prefetch" href="/assets/js/54.53388fc4.js"><link rel="prefetch" href="/assets/js/55.fc24bc21.js"><link rel="prefetch" href="/assets/js/56.9b3c2535.js"><link rel="prefetch" href="/assets/js/57.ba13dd55.js"><link rel="prefetch" href="/assets/js/58.9a4c6a43.js"><link rel="prefetch" href="/assets/js/59.96e435e7.js"><link rel="prefetch" href="/assets/js/6.95fccca8.js"><link rel="prefetch" href="/assets/js/60.d17a46b6.js"><link rel="prefetch" href="/assets/js/61.0860ef3f.js"><link rel="prefetch" href="/assets/js/62.713860bc.js"><link rel="prefetch" href="/assets/js/63.38e7edcf.js"><link rel="prefetch" href="/assets/js/64.176f8bbb.js"><link rel="prefetch" href="/assets/js/65.903f4b50.js"><link rel="prefetch" href="/assets/js/66.1c5277a5.js"><link rel="prefetch" href="/assets/js/67.abfce232.js"><link rel="prefetch" href="/assets/js/68.37814697.js"><link rel="prefetch" href="/assets/js/69.c77c3c67.js"><link rel="prefetch" href="/assets/js/7.d035404c.js"><link rel="prefetch" href="/assets/js/70.742159c8.js"><link rel="prefetch" href="/assets/js/71.00f8f464.js"><link rel="prefetch" href="/assets/js/72.c8145491.js"><link rel="prefetch" href="/assets/js/73.edd94acd.js"><link rel="prefetch" href="/assets/js/74.deb52f36.js"><link rel="prefetch" href="/assets/js/75.5969aaa2.js"><link rel="prefetch" href="/assets/js/76.24433b28.js"><link rel="prefetch" href="/assets/js/77.e1a029bc.js"><link rel="prefetch" href="/assets/js/78.ec41973a.js"><link rel="prefetch" href="/assets/js/79.a8436b64.js"><link rel="prefetch" href="/assets/js/8.d1c35f37.js"><link rel="prefetch" href="/assets/js/80.70d752cd.js"><link rel="prefetch" href="/assets/js/81.5392aaa4.js"><link rel="prefetch" href="/assets/js/82.87f6938e.js"><link rel="prefetch" href="/assets/js/83.9efaf755.js"><link rel="prefetch" href="/assets/js/84.d0bba92a.js"><link rel="prefetch" href="/assets/js/85.f8f968c5.js"><link rel="prefetch" href="/assets/js/86.9e5296f6.js"><link rel="prefetch" href="/assets/js/87.8774d4bd.js"><link rel="prefetch" href="/assets/js/88.7513e6b5.js"><link rel="prefetch" href="/assets/js/89.421b5237.js"><link rel="prefetch" href="/assets/js/9.220b3eb6.js"><link rel="prefetch" href="/assets/js/90.47497ac9.js"><link rel="prefetch" href="/assets/js/91.20e7b656.js"><link rel="prefetch" href="/assets/js/92.ab742aa0.js"><link rel="prefetch" href="/assets/js/93.6f6eef2e.js"><link rel="prefetch" href="/assets/js/94.b8ff20d8.js"><link rel="prefetch" href="/assets/js/95.e97d80de.js"><link rel="prefetch" href="/assets/js/96.7f9bfe96.js"><link rel="prefetch" href="/assets/js/97.5bc5b95e.js"><link rel="prefetch" href="/assets/js/98.07280354.js"><link rel="prefetch" href="/assets/js/99.be9ded95.js">
    <link rel="stylesheet" href="/assets/css/0.styles.34788bb2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">NodeJS</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/core/" class="nav-link">Node</a></div><div class="nav-item"><a href="/packageManager/" class="nav-link">Manager</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Nestjs" class="dropdown-title"><span class="title">Nestjs</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/framework/nestjs/office-docs/" class="nav-link router-link-active">NestJS 官方文档</a></li><li class="dropdown-item"><!----> <a href="/nestjs/source-codes/" class="nav-link">NestJS 源码</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="framework" class="dropdown-title"><span class="title">framework</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/framework/egg/" class="nav-link">egg</a></li><li class="dropdown-item"><!----> <a href="/framework/express/" class="nav-link">express</a></li><li class="dropdown-item"><!----> <a href="/framework/fasitify/" class="nav-link">fasitify</a></li><li class="dropdown-item"><!----> <a href="/framework/hapi/" class="nav-link">hapi</a></li><li class="dropdown-item"><!----> <a href="/framework/koa/" class="nav-link">koa</a></li><li class="dropdown-item"><!----> <a href="/framework/midway/" class="nav-link">midway</a></li></ul></div></div><div class="nav-item"><a href="/graphql/" class="nav-link">graphql</a></div><div class="nav-item"><a href="/TypeORM/" class="nav-link">TypeORM</a></div><div class="nav-item"><a href="/branchmark/" class="nav-link">性能</a></div><div class="nav-item"><a href="/vendor/" class="nav-link">第三方包</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/core/" class="nav-link">Node</a></div><div class="nav-item"><a href="/packageManager/" class="nav-link">Manager</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Nestjs" class="dropdown-title"><span class="title">Nestjs</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/framework/nestjs/office-docs/" class="nav-link router-link-active">NestJS 官方文档</a></li><li class="dropdown-item"><!----> <a href="/nestjs/source-codes/" class="nav-link">NestJS 源码</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="framework" class="dropdown-title"><span class="title">framework</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/framework/egg/" class="nav-link">egg</a></li><li class="dropdown-item"><!----> <a href="/framework/express/" class="nav-link">express</a></li><li class="dropdown-item"><!----> <a href="/framework/fasitify/" class="nav-link">fasitify</a></li><li class="dropdown-item"><!----> <a href="/framework/hapi/" class="nav-link">hapi</a></li><li class="dropdown-item"><!----> <a href="/framework/koa/" class="nav-link">koa</a></li><li class="dropdown-item"><!----> <a href="/framework/midway/" class="nav-link">midway</a></li></ul></div></div><div class="nav-item"><a href="/graphql/" class="nav-link">graphql</a></div><div class="nav-item"><a href="/TypeORM/" class="nav-link">TypeORM</a></div><div class="nav-item"><a href="/branchmark/" class="nav-link">性能</a></div><div class="nav-item"><a href="/vendor/" class="nav-link">第三方包</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>总览-OVERVIEW</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>基本原理 - Fundamentals</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/framework/nestjs/office-docs/02-fundamentals/01-customProviders.html" class="sidebar-link">自定义 Providers</a></li><li><a href="/framework/nestjs/office-docs/02-fundamentals/02-AsynchronousProviders.html" class="sidebar-link">异步 Provider</a></li><li><a href="/framework/nestjs/office-docs/02-fundamentals/03-dynamicModules.html" class="active sidebar-link">动态模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/framework/nestjs/office-docs/02-fundamentals/03-dynamicModules.html#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/framework/nestjs/office-docs/02-fundamentals/03-dynamicModules.html#动态模块使用案例" class="sidebar-link">动态模块使用案例</a></li><li class="sidebar-sub-header"><a href="/framework/nestjs/office-docs/02-fundamentals/03-dynamicModules.html#配置模块" class="sidebar-link">配置模块</a></li><li class="sidebar-sub-header"><a href="/framework/nestjs/office-docs/02-fundamentals/03-dynamicModules.html#模块配置" class="sidebar-link">模块配置</a></li></ul></li><li><a href="/framework/nestjs/office-docs/02-fundamentals/04-injectionScopes.html" class="sidebar-link">Inject 范围</a></li><li><a href="/framework/nestjs/office-docs/02-fundamentals/05-cicularDependency.html" class="sidebar-link">循环依赖</a></li><li><a href="/framework/nestjs/office-docs/02-fundamentals/06-moduleReference.html" class="sidebar-link">模块引用</a></li><li><a href="/framework/nestjs/office-docs/02-fundamentals/07-executionContext.html" class="sidebar-link">执行上下文</a></li><li><a href="/framework/nestjs/office-docs/02-fundamentals/08-lifecycleEvents.html" class="sidebar-link">生命周期事件</a></li><li><a href="/framework/nestjs/office-docs/02-fundamentals/09-platformAgnosticism.html" class="sidebar-link">平台不可知论</a></li><li><a href="/framework/nestjs/office-docs/02-fundamentals/10-testing.html" class="sidebar-link">测试中</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>技术技巧 - Techniques</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Graphql</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Web 套接字</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>微服务</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>单 App</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>脚手架 CLI</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>食谱 Recipes</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>FQA</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="动态模块"><a href="#动态模块" class="header-anchor">#</a> 动态模块</h1> <p>”模块“一章介绍了Nest模块系统的基础知识，并简要介绍了动态模块。本章扩展了动态模块的主题。完后后，您应该对他们是什么以及如何使用他们有很好的了解。</p> <h2 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h2> <p>”文档概述“部分中的大部分应用程序代码示例都是使用常规或者静态模块。模块定义了组件。例如提供程序和控制器，他们可以作为整个应用程序的模块化部分组合分割在一起。他们为这些组件了上下文或范围。例如： 模块中定义的提供者对模块的其他成员，而无需导出他们。当提供者需要在模块外部分可见时。他首先从主机模块中导出，当然导入到齐使用模块中。</p> <p>让我们来看看的例子。</p> <p>首先，我们将定义 UserModule 提供和导出的 UserModule。 UserModule 是的主机模块 UserModule。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Module <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UsersService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span> UsersService <span class="token punctuation">]</span><span class="token punctuation">,</span>
  exports<span class="token operator">:</span> <span class="token punctuation">[</span> UsersService <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UsersModule</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>接下来，我们定义一个 AuthModule import UserModule，使 UserModule 的提供者咋内容部使用 AuthModule：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Module <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AuthService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./auth.service'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UsersModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../users/users.module'</span><span class="token punctuation">;</span>

@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>UsersModule<span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>AuthService<span class="token punctuation">]</span><span class="token punctuation">,</span>
  exports<span class="token operator">:</span> <span class="token punctuation">[</span>AuthService<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AuthModule</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>这些构造使我们能够注入 UsersService 例如 AuthService 托管在中的 AuthModule：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UsersService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../users/users.service'</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AuthService</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">private</span> UsersService<span class="token operator">:</span> UsersService</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们将其成为静态模块绑定。 Nest 已在主机和使用方模块中声明了将模块连接在一起的所有信息。让我们解压此过程中发生的事情。 Nest 通过以下方式 UsersService 提供内部使用 AuthModule：</p> <ol><li>实例化UsersModule，包括可迁移地导入其UsersModule本身消耗的其他模块，以及可迁移地解决任何依赖关系（请参阅自定义提供程序）。</li> <li>实例化AuthModule，并使UsersModule的提供者可用于中的组件AuthModule（就像它们在中声明一样AuthModule）。</li> <li>入UsersServicein 的实例AuthService。</li></ol> <h2 id="动态模块使用案例"><a href="#动态模块使用案例" class="header-anchor">#</a> 动态模块使用案例</h2> <p>使用静态模块绑定，使用模块就没有机会影响如何配置主机模块的提供程序。为什么这么重要？考虑以下情况：我们有一个通用模块，该模块在不同用例中需要表现不同。这类似于许多系统中的“插件”的概念，在该系统中，通用设施需要一些配置才能被消费者使用。</p> <p>Nest的一个很好的例子是配置模块。许多应用程序发现使用配置模块来外部化配置详细信息很有用。这使得可以轻松地在不同的部署中动态更改应用程序设置：例如，开发人员的开发数据库，​​过渡/测试环境的过渡数据库等。通过将配置参数的管理委派给配置模块，应用程序源代码保持独立于配置参数。</p> <p>挑战在于，配置模块本身是通用的（类似于“插件”），因此需要由其使用模块自定义。这是动态模块起作用的地方。使用动态模块功能，我们可以使我们的配置模块动态化，以便使用模块可以使用API​​来控制在导入配置模块时如何对其进行自定义。</p> <p>换句话说，动态模块提供了一个API，用于将一个模块导入另一个模块，并在导入该模块时自定义该模块的属性和行为，这与使用到目前为止我们看到的静态绑定相反。</p> <h2 id="配置模块"><a href="#配置模块" class="header-anchor">#</a> 配置模块</h2> <p>在本节的配置章节中，我们将使用示例代码的基本版本。截止本章末尾的完整版本可在此处作为工作示例使用。</p> <p>我们的要求是使ConfigModule一个options对象自定义。这是我们要支持的功能。基本示例将.env文件的位置硬编码在项目根文件夹中。假设我们要使它可配置，以便您可以管理.env您选择的任何文件夹中的文件。例如，假设您想将各种.env文件存储在项目根目录下的文件夹中config（即的同级文件夹src）。ConfigModule在不同的项目中使用时，您希望能够选择其他文件夹。</p> <p>动态模块使我们能够将参数传递到要导入的模块中，以便我们可以更改其行为。让我们看看它是如何工作的。如果我们从最终目标开始，即从使用模块的角度看，然后向后工作，这将很有帮助。首先，让我们快速回顾一下静态导入的示例ConfigModule（即，一种无法影响导入模块行为的方法）。请密切注意装饰器中的imports数组@Module()：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Module <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppController <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app.controller'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app.service'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ConfigModel <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./config/config.module'</span>

@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span> ConfigModel <span class="token punctuation">]</span><span class="token punctuation">,</span>
  controller<span class="token operator">:</span> <span class="token punctuation">[</span> AppController <span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span> AppService <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>让我们考虑一下动态模块导入（我们在其中传递配置对象的地方）的外观。比较imports这两个示例之间的数组差异:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Module <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppController <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app.controller'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app.service'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ConfigModel <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./config/config.module'</span><span class="token punctuation">;</span>

@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>ConfigModel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">{</span> folder<span class="token operator">:</span> <span class="token string">'./config'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  controllers<span class="token operator">:</span> <span class="token punctuation">[</span>AppController<span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>AppService<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>让我们看看上面的动态示例中发生了什么。有哪些运动部件？</p> <ul><li>ConfigModule是一个普通的类，因此我们可以推断出它必须具有一个称为的静态方法register()。我们知道它是静态的，因为我们在ConfigModule类上而不是在类的实例上调用它。注意：我们即将创建的此方法可以具有任意名称，但按照惯例，我们应将其命名为forRoot()或register()。</li> <li>该register()方法由我们定义，因此我们可以接受任何喜欢的输入参数。在这种情况下，我们将接受options具有适当属性的简单对象，这是典型的情况。</li> <li>我们可以推断出该register()方法必须返回类似的module值，因为其返回值出现在熟悉的imports列表中，到目前为止，我们已经看到该列表包括模块列表。</li></ul> <p>实际上，我们的register()方法将返回DynamicModule。动态模块只不过是在运行时创建的模块，具有与静态模块相同的确切属性，外加一个称为的附加属性module。让我们快速查看示例静态模块声明，并密切注意传递给装饰器的模块选项：</p> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>DogsService<span class="token punctuation">]</span><span class="token punctuation">,</span>
  controllers<span class="token operator">:</span> <span class="token punctuation">[</span>CatsController<span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>CatsService<span class="token punctuation">]</span><span class="token punctuation">,</span>
  exports<span class="token operator">:</span> <span class="token punctuation">[</span>CatsService<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>动态模块必须返回一个具有完全相同接口的对象，以及一个称为的附加属性module。该module属性用作模块的名称，并且应与模块的类名相同，如下例所示。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>提示
对于动态模块，除了之外，模块选项对象的所有属性都是可选的module。</p></div> <p>静态register()方法呢？现在我们可以看到它的工作是返回具有DynamicModule接口的对象。当我们调用它时，我们实际上是在为imports列表提供模块，类似于在静态情况下通过列出模块类名的方式。换句话说，动态模块API只是返回一个模块，而不是固定@Modules装饰器中的属性，而是通过编程方式指定它们。</p> <p>仍然需要涵盖一些细节以帮助使图片完整：</p> <ol><li>现在我们可以声明@Module()装饰器的imports属性不仅可以采用模块类名称（例如imports: [UsersModule]），还可以采用返回动态模块的函数（例如imports: [ConfigModule.register(...)]）。</li> <li>动态模块本身可以导入其他模块。在此示例中，我们不会这样做，但是如果动态模块依赖于其他模块中的提供程序，则可以使用optional imports属性导入它们。同样，这完全类似于您使用@Module()装饰器为静态模块声明元数据的方式。</li></ol> <p>有了这种理解，我们现在可以看动态ConfigModule声明必须是什么样子。让我们来解决一下。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> DynamicModule<span class="token punctuation">,</span> Module <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ConfigService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./config.service'</span><span class="token punctuation">;</span>

@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ConfigModule</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> DynamicModule <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token keyword">module</span><span class="token operator">:</span> ConfigModule<span class="token punctuation">,</span>
      providers<span class="token operator">:</span> <span class="token punctuation">[</span> ConfigService <span class="token punctuation">]</span><span class="token punctuation">,</span>
      exports<span class="token operator">:</span> <span class="token punctuation">[</span> ConfigService <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>现在应该清楚各部分如何结合在一起。调用会ConfigModule.register(...)返回一个DynamicModule对象，该对象的属性与到现在为止通过@Module()装饰器作为元数据提供的属性基本相同。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>提示
DynamicModule从导入@nestjs/common。</p></div> <p>但是，我们的动态模块还不是很有趣，因为我们没有像我们所说的那样引入任何配置它的功能。接下来解决这个问题。</p> <h2 id="模块配置"><a href="#模块配置" class="header-anchor">#</a> 模块配置</h2> <p>如上所猜，自定义的行为的明显解决方案ConfigModule是将其通过options静态register()方法传递给对象。让我们再次看一下消费模块的imports属性</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Module <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppController <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app.controller'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app.service'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ConfigModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./config/config.module'</span><span class="token punctuation">;</span>

@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>ConfigModule<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">{</span> folder<span class="token operator">:</span> <span class="token string">'./config'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  controllers<span class="token operator">:</span> <span class="token punctuation">[</span>AppController<span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>AppService<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>很好地处理了将options对象传递到动态模块的过程。然后如何在中使用该options对象ConfigModule？让我们考虑一下。我们知道，我们ConfigModule基本上是提供和导出可注射服务ConfigService（供其他提供商使用）的主机。实际上，我们ConfigService需要读取options对象以自定义其行为。现在让我们假设我们知道如何以某种方式options将register()方法从中获取ConfigService。基于此假设，我们可以对服务进行一些更改，以基于options对象的属性来自定义其行为。（注意：由于我们暂时还没有实际上确定了如何传递它，我们将只进行硬编码options。我们将在一分钟内解决此问题）。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> dotenv <span class="token keyword">from</span> <span class="token string">'dotenv'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> fs <span class="token keyword">from</span> <span class="token string">'fs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> EnvConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./interfaces'</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ConfigService</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">readonly</span> envConfig<span class="token operator">:</span> EnvConfig<span class="token punctuation">;</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span> folder<span class="token operator">:</span> <span class="token string">'./config'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> filePath <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">||</span> <span class="token string">'development'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.env</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> envFile <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../../'</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>folder<span class="token punctuation">,</span> filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>envConfig <span class="token operator">=</span> dotenv<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>envFile<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">get</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>envConfig<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>现在，我们ConfigService知道了如何.env在中指定的文件夹中查找文件options。</p> <p>我们剩下的任务是以某种方式将options对象从register()步骤注入到我们的对象中ConfigService。当然，我们将使用依赖注入来实现。这是关键点，因此请确保您理解它。我们ConfigModule正在提供ConfigService。ConfigService依次取决于options仅在运行时提供的对象。因此，在运行时，我们需要先将options对象绑定到Nest IoC容器，然后将Nest注入到我们的容器中ConfigService。请记住，在“ 自定义提供程序”一章中，提供程序不仅可以包含服务，还可以包含任何值，因此我们可以使用依赖注入来处理简单options对象。</p> <p>让我们首先解决将选项对象绑定到IoC容器的问题。我们使用静态register()方法执行此操作。请记住，我们是在动态构造模块，模块的属性之一是其提供程序列表。因此，我们需要做的是将options对象定义为提供者。这将使其可注入ConfigService，我们将在下一步中利用它。在下面的代码中，请注意providers数组：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> DynamicModule<span class="token punctuation">,</span> Module <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ConfigService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./config.service'</span><span class="token punctuation">;</span>

@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ConfigModule</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token function">register</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token operator">:</span> DynamicModule <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token keyword">module</span><span class="token operator">:</span> ConfigModule<span class="token punctuation">,</span>
      providers<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          provide<span class="token operator">:</span> <span class="token string">'CONFIG_OPTIONS'</span><span class="token punctuation">,</span>
          useValue<span class="token operator">:</span> options<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        ConfigService<span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      exports<span class="token operator">:</span> <span class="token punctuation">[</span>ConfigService<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>现在，我们可以通过将'CONFIG_OPTIONS'提供程序注入来完成此过程ConfigService。回想一下，当我们使用非类令牌定义提供程序时，我们需要使用此处所述的@Inject()装饰器。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> dotenv <span class="token keyword">from</span> <span class="token string">'dotenv'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> fs <span class="token keyword">from</span> <span class="token string">'fs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable<span class="token punctuation">,</span> Inject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> EnvConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./interfaces'</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ConfigService</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">readonly</span> envConfig<span class="token operator">:</span> EnvConfig<span class="token punctuation">;</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span>@<span class="token function">Inject</span><span class="token punctuation">(</span><span class="token string">'CONFIG_OPTIONS'</span><span class="token punctuation">)</span> <span class="token keyword">private</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> filePath <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">||</span> <span class="token string">'development'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.env</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> envFile <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../../'</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>folder<span class="token punctuation">,</span> filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>envConfig <span class="token operator">=</span> dotenv<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>envFile<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">get</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>envConfig<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>最后一点：为简单起见，我们在上面使用了基于字符串的注入令牌（'CONFIG_OPTIONS'），但最佳实践是Symbol在单独的文件中将其定义为常量（或），然后导入该文件。例如：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">CONFIG_OPTIONS</span> <span class="token operator">=</span> <span class="token string">'CONFIG_OPTIONS'</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/framework/nestjs/office-docs/02-fundamentals/02-AsynchronousProviders.html" class="prev">异步 Provider</a></span> <span class="next"><a href="/framework/nestjs/office-docs/02-fundamentals/04-injectionScopes.html">Inject 范围</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.12ca0aa8.js" defer></script><script src="/assets/js/2.74bffc86.js" defer></script><script src="/assets/js/46.045cad94.js" defer></script>
  </body>
</html>
